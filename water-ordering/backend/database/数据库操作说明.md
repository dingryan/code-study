# 数据库操作说明

## 重要原则

**所有业务数据的增删改查都通过 API 接口进行，不要直接操作数据库！**

## 数据库操作方式

### ✅ 正确方式：通过 API 接口

所有业务数据的操作都应该通过以下接口进行：

- **用户数据**：
  - 创建/登录：`POST /api/auth/phone-login`
  - 查询：`GET /api/users/me`
  - 更新：`PUT /api/users/me`

- **管理员数据**：
  - 登录：`POST /api/admin-auth/login`
  - 修改密码：`POST /api/admin-auth/change-password`
  - 查询：`GET /api/admin-auth/me`

- **商品数据**：
  - 查询（公开）：`GET /api/products/`
  - 创建：`POST /api/products/`（需要管理员）
  - 更新：`PUT /api/products/{id}`（需要管理员）
  - 删除：`DELETE /api/products/{id}`（需要管理员）

- **订单数据**：
  - 创建：`POST /api/orders/`（需要已验证手机号）
  - 查询：`GET /api/orders/`（需要登录）
  - 取消：`PUT /api/orders/{id}/cancel`（需要登录）

- **地址数据**：
  - 创建：`POST /api/addresses/`（需要登录）
  - 查询：`GET /api/addresses/`（需要登录）
  - 更新：`PUT /api/addresses/{id}`（需要登录）
  - 删除：`DELETE /api/addresses/{id}`（需要登录）

### ❌ 错误方式：直接操作数据库

**不要直接执行以下操作：**
- ❌ `INSERT INTO users ...` - 应该通过登录接口创建
- ❌ `UPDATE users SET ...` - 应该通过用户接口更新
- ❌ `INSERT INTO products ...` - 应该通过商品管理接口创建
- ❌ `UPDATE orders SET status ...` - 应该通过订单接口操作
- ❌ `DELETE FROM addresses ...` - 应该通过地址接口删除

## 数据库初始化

数据库表的创建和初始化是例外，需要手动执行 SQL：

1. **创建表**：执行 `database/init.sql`
2. **创建管理员**：使用 `scripts/init_admin_user.py`（因为需要密码加密）
3. **添加测试数据**：可选，执行 `database/test_data.sql` 或使用 `scripts/init_data.py`

## 为什么通过接口操作？

1. **数据验证**：接口会验证数据格式和业务规则
2. **权限控制**：接口会检查用户权限
3. **业务逻辑**：接口会执行完整的业务逻辑（如订单创建时扣减库存）
4. **数据一致性**：接口保证数据的一致性
5. **安全性**：接口提供认证和授权保护

## 特殊情况

以下情况可以例外直接操作数据库：

1. **数据库初始化**：创建表结构
2. **数据迁移**：批量数据迁移
3. **数据修复**：修复数据错误
4. **数据备份/恢复**：数据库维护操作

但这些操作都应该谨慎进行，并做好备份。

