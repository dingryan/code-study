# 快速参考卡片

## 🚀 快速启动

```bash
# 1. 启动后端
cd water-ordering/backend
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# 2. 启动Web后台（新终端）
cd water-ordering/web-admin
npm run dev

# 3. 打开小程序
# 微信开发者工具 → 导入项目 → 选择 miniprogram 目录
```

## 📱 小程序功能清单

| 功能 | 是否需要登录 | 操作路径 |
|------|------------|---------|
| 浏览商品 | ❌ 否 | 首页 → 商品列表 |
| 查看商品详情 | ❌ 否 | 首页 → 点击商品 |
| 加入购物车 | ✅ 是 | 商品详情 → 加入购物车 |
| 立即购买 | ✅ 是 | 商品详情 → 立即购买 |
| 购物车管理 | ✅ 是 | 底部导航 → 购物车 |
| 结算下单 | ✅ 是 | 购物车 → 结算 |
| 查看订单 | ✅ 是 | 底部导航 → 订单 |
| 管理地址 | ✅ 是 | 我的 → 收货地址 |
| 登录 | - | 需要登录时自动跳转 |

## 💻 Web后台功能清单

| 功能 | 操作路径 |
|------|---------|
| 登录 | http://localhost:5173 → 输入手机号验证码 |
| 商品列表 | 登录后自动进入 |
| 新增商品 | 商品管理 → 新增商品 |
| 编辑商品 | 商品管理 → 点击编辑 |
| 上下架 | 商品管理 → 点击上架/下架 |
| 更新库存 | 商品管理 → 点击库存 |
| 删除商品 | 商品管理 → 点击删除 |
| 订单列表 | 顶部导航 → 订单管理 |
| 订单详情 | 订单列表 → 点击订单 |

## 🔑 登录方式

### 小程序登录
1. 输入手机号（11位）
2. 点击"发送验证码"
3. **开发环境**：查看后端控制台或页面提示获取验证码
4. 输入6位验证码
5. 点击"登录"

### Web后台登录
1. 打开 http://localhost:5173
2. 输入管理员手机号
3. 发送验证码并输入
4. 登录（只有管理员可以登录）

## 📋 常用API

### 发送验证码
```bash
POST http://localhost:8000/api/auth/send-code
Body: {"phone": "13800138000"}
```

### 登录
```bash
POST http://localhost:8000/api/auth/phone-login
Body: {"phone": "13800138000", "code": "123456"}
```

### 获取商品列表
```bash
GET http://localhost:8000/api/products/
```

### 创建订单（需要token）
```bash
POST http://localhost:8000/api/orders/
Headers: Authorization: Bearer {token}
Body: {
  "address_id": 1,
  "items": [{"product_id": 1, "quantity": 1, "price": 10.00}]
}
```

## 🛠️ 常用命令

### 数据库操作
```bash
# 初始化数据库
cd water-ordering/backend
python scripts/init_db.py

# 添加测试数据
python scripts/init_data.py

# 清空测试数据
python scripts/init_data.py --clear
```

### 设置管理员
```sql
UPDATE users SET is_admin = 1 WHERE phone = '13800138000';
```

## 🔍 验证码获取（开发环境）

**方式1：后端控制台**
- 发送验证码后，查看后端控制台输出
- 格式：`[开发环境] 手机号 13800138000 的验证码: 123456`

**方式2：API响应**
- 开发环境下，API响应中包含 `code` 字段

**方式3：小程序页面**
- 开发环境下，登录页面会显示验证码

## ⚠️ 权限说明

### 小程序权限
- **未登录**：只能浏览商品，不能下单、加购物车、查看订单
- **已登录**：可以使用所有功能

### Web后台权限
- **非管理员**：无法登录，提示"您不是管理员"
- **管理员**：可以使用所有后台功能

### API权限
- **公开接口**：商品列表、商品详情
- **需要登录**：地址管理、订单查询
- **需要验证手机号**：创建订单

## 📍 访问地址

| 服务 | 地址 |
|------|------|
| 后端API | http://localhost:8000 |
| API文档 | http://localhost:8000/docs |
| 健康检查 | http://localhost:8000/health |
| Web后台 | http://localhost:5173 |
| 小程序 | 微信开发者工具 |

## 🐛 常见问题快速解决

| 问题 | 解决方法 |
|------|---------|
| 后端无法启动 | 检查端口8000是否被占用，检查数据库连接 |
| 数据库连接失败 | 检查MySQL服务，检查config.yaml配置 |
| 验证码收不到 | 开发环境查看后端控制台 |
| 订单创建失败 | 确保用户已验证手机号 |
| Web端无法连接 | 检查.env.development配置 |
| 小程序无法连接 | 关闭域名校验，检查app.js配置 |
| 不是管理员 | 执行SQL设置is_admin=1 |

## 📚 详细文档

- **完整使用手册**：`完整使用手册.md`
- **验证指南**：`验证指南.md`
- **使用文档**：`使用文档.md`

